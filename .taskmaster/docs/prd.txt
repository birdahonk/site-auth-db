# Product Requirements Document: Reusable Website Foundation

**Version:** 1.2
**Last Updated:** 2025-12-16
**Status:** Draft

---

## Table of Contents

1. [Executive Summary](#executive-summary)
2. [Problem Statement](#problem-statement)
3. [Goals & Objectives](#goals--objectives)
4. [User Personas & Tiers](#user-personas--tiers)
5. [Technical Architecture](#technical-architecture)
6. [Authentication System](#authentication-system)
7. [Database Design](#database-design)
8. [Feature Requirements](#feature-requirements)
9. [Admin Dashboard](#admin-dashboard)
10. [Project Structure](#project-structure)
11. [VPS Deployment Architecture](#vps-deployment-architecture)
12. [Setup & Configuration Guide](#setup--configuration-guide)
13. [Security Considerations](#security-considerations)
14. [Reusability Guidelines](#reusability-guidelines)
15. [Future Considerations](#future-considerations)

---

## Executive Summary

This document outlines the requirements for a **clean, reusable website foundation** that provides:

- Robust authentication with multi-tier user access control
- Supabase PostgreSQL database integration with Row Level Security
- Lightweight custom admin dashboard for user management
- A modular architecture designed to be copied and extended for various projects
- Self-managed authentication using Supabase Auth (recommended over Clerk for self-hosted control)
- VPS deployment architecture with reverse proxy configuration for production hosting

The foundation serves as a "starter template" that can be cloned and customized for different web applications while maintaining consistent security patterns and code organization.

---

## Problem Statement

Building a new web application from scratch requires repeatedly implementing:

- User authentication and session management
- Role-based access control systems
- Database connections and schema management
- Protected routes and API endpoints
- Consistent project structure

This foundation eliminates repetitive boilerplate work while ensuring security best practices are built-in from the start.

---

## Goals & Objectives

### Primary Goals

| Goal | Success Metric |
|------|----------------|
| Create a reusable foundation | Clone-to-running-app in < 30 minutes |
| Implement secure authentication | Zero auth-related vulnerabilities |
| Support tiered user access | Configurable N-tier access system |
| Integrate Supabase database | Full CRUD with RLS policies |
| Ensure maintainability | Clear documentation, typed codebase |

### Non-Goals

- Building a complete application (this is a shell)
- Implementing business-specific features
- Creating a full design system (basic styling only)

---

## User Personas & Tiers

### Tier System Architecture

The foundation supports a flexible N-tier system. Default configuration includes:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     TIER HIERARCHY                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  TIER 0: Anonymous       â”‚ Public pages only               â”‚
â”‚  TIER 1: Free User       â”‚ Basic authenticated access      â”‚
â”‚  TIER 2: Premium User    â”‚ Enhanced features + content     â”‚
â”‚  TIER 3: Admin           â”‚ Full system access + management â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Access Control Matrix

| Resource Type | Anonymous | Free | Premium | Admin |
|--------------|-----------|------|---------|-------|
| Public Pages | âœ“ | âœ“ | âœ“ | âœ“ |
| Dashboard | âœ— | âœ“ | âœ“ | âœ“ |
| Premium Content | âœ— | âœ— | âœ“ | âœ“ |
| Admin Panel | âœ— | âœ— | âœ— | âœ“ |
| API: Public | âœ“ | âœ“ | âœ“ | âœ“ |
| API: Protected | âœ— | âœ“ | âœ“ | âœ“ |
| API: Admin | âœ— | âœ— | âœ— | âœ“ |

---

## Technical Architecture

### Recommended Technology Stack

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FRONTEND                                â”‚
â”‚  Next.js 14+ (App Router) â”‚ React 18 â”‚ TypeScript â”‚ Tailwind  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      AUTHENTICATION                            â”‚
â”‚        Supabase Auth (Self-managed, integrated with DB)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        DATABASE                                â”‚
â”‚  Supabase PostgreSQL â”‚ Row Level Security â”‚ Real-time (opt)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                       UTILITIES                                â”‚
â”‚   Zod (validation) â”‚ React Hook Form â”‚ Tanstack Query (opt)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Why Supabase Auth Over Clerk?

| Factor | Supabase Auth | Clerk |
|--------|---------------|-------|
| Self-managed | âœ“ Full control | âœ— Vendor-managed |
| Data ownership | âœ“ Your database | âœ— External storage |
| Cost | âœ“ Generous free tier | $ Paid at scale |
| Database integration | âœ“ Native RLS | âœ— Separate sync needed |
| Security updates | âœ“ Client updates | âœ“ Automatic |
| Offline capability | âœ“ Self-hostable | âœ— Cloud-only |
| OAuth providers | âœ“ All major | âœ“ All major |
| MFA support | âœ“ TOTP, SMS | âœ“ Multiple options |

**Recommendation:** Use **Supabase Auth** for this foundation because:
1. Already integrating Supabase for database
2. Native Row Level Security integration
3. Full data ownership and self-management
4. No additional vendor dependencies
5. Automatic security updates via `@supabase/supabase-js` package updates

---

## Authentication System

### Authentication Flows

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AUTHENTICATION FLOWS                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. EMAIL/PASSWORD SIGNUP                                       â”‚
â”‚     User â†’ Email/Pass â†’ Supabase Auth â†’ Verification Email     â”‚
â”‚     â†’ Email Confirmed â†’ Profile Created â†’ Session Issued       â”‚
â”‚                                                                 â”‚
â”‚  2. EMAIL/PASSWORD LOGIN                                        â”‚
â”‚     User â†’ Email/Pass â†’ Supabase Auth â†’ Session Issued         â”‚
â”‚     â†’ JWT Token â†’ Stored in HTTP-only Cookie                   â”‚
â”‚                                                                 â”‚
â”‚  3. OAUTH (Google, GitHub, etc.)                               â”‚
â”‚     User â†’ Provider â†’ Callback â†’ Profile Upsert â†’ Session      â”‚
â”‚                                                                 â”‚
â”‚  4. MAGIC LINK (Optional)                                       â”‚
â”‚     User â†’ Email â†’ Magic Link Sent â†’ Click â†’ Session Issued    â”‚
â”‚                                                                 â”‚
â”‚  5. PASSWORD RESET                                              â”‚
â”‚     User â†’ Email â†’ Reset Link â†’ New Password â†’ Redirect        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Session Management

- **Server-side sessions** via Supabase Auth Helpers
- **JWT tokens** stored in HTTP-only cookies (secure, no XSS exposure)
- **Automatic token refresh** handled by Supabase client
- **Session duration:** Configurable (default 1 week)

---

## Database Design

### Core Schema

```sql
-- ============================================
-- CORE TABLES (Managed by Supabase Auth)
-- ============================================
-- auth.users (built-in, do not modify directly)

-- ============================================
-- APPLICATION TABLES
-- ============================================

-- User Profiles (extends auth.users)
CREATE TABLE public.profiles (
    id UUID REFERENCES auth.users(id) PRIMARY KEY,
    email TEXT NOT NULL,
    full_name TEXT,
    avatar_url TEXT,
    tier INTEGER DEFAULT 1 CHECK (tier >= 0 AND tier <= 10),
    tier_name TEXT GENERATED ALWAYS AS (
        CASE tier
            WHEN 0 THEN 'anonymous'
            WHEN 1 THEN 'free'
            WHEN 2 THEN 'premium'
            WHEN 3 THEN 'admin'
            ELSE 'custom_' || tier::text
        END
    ) STORED,
    metadata JSONB DEFAULT '{}',
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Tier Definitions (for dynamic tier management)
CREATE TABLE public.tiers (
    id SERIAL PRIMARY KEY,
    tier_level INTEGER UNIQUE NOT NULL,
    name TEXT NOT NULL,
    description TEXT,
    permissions JSONB DEFAULT '[]',
    max_resources JSONB DEFAULT '{}',
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Insert default tiers
INSERT INTO public.tiers (tier_level, name, description, permissions) VALUES
    (0, 'anonymous', 'Unauthenticated visitors', '["read:public"]'),
    (1, 'free', 'Free registered users', '["read:public", "read:basic", "write:own"]'),
    (2, 'premium', 'Premium subscribers', '["read:public", "read:basic", "read:premium", "write:own"]'),
    (3, 'admin', 'System administrators', '["*"]');

-- Audit Log (optional but recommended)
CREATE TABLE public.audit_log (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    user_id UUID REFERENCES auth.users(id),
    action TEXT NOT NULL,
    resource_type TEXT,
    resource_id TEXT,
    metadata JSONB DEFAULT '{}',
    ip_address INET,
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

### Row Level Security Policies

```sql
-- ============================================
-- ROW LEVEL SECURITY POLICIES
-- ============================================

-- Enable RLS on all tables
ALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.tiers ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.audit_log ENABLE ROW LEVEL SECURITY;

-- PROFILES POLICIES
-- Users can read their own profile
CREATE POLICY "Users can view own profile"
    ON public.profiles FOR SELECT
    USING (auth.uid() = id);

-- Users can update their own profile (except tier)
CREATE POLICY "Users can update own profile"
    ON public.profiles FOR UPDATE
    USING (auth.uid() = id)
    WITH CHECK (auth.uid() = id);

-- Admins can view all profiles
CREATE POLICY "Admins can view all profiles"
    ON public.profiles FOR SELECT
    USING (
        EXISTS (
            SELECT 1 FROM public.profiles
            WHERE id = auth.uid() AND tier >= 3
        )
    );

-- Admins can update any profile
CREATE POLICY "Admins can update any profile"
    ON public.profiles FOR UPDATE
    USING (
        EXISTS (
            SELECT 1 FROM public.profiles
            WHERE id = auth.uid() AND tier >= 3
        )
    );

-- TIERS POLICIES
-- Anyone can read tier definitions
CREATE POLICY "Anyone can read tiers"
    ON public.tiers FOR SELECT
    TO authenticated, anon
    USING (true);

-- Only admins can modify tiers
CREATE POLICY "Admins can modify tiers"
    ON public.tiers FOR ALL
    USING (
        EXISTS (
            SELECT 1 FROM public.profiles
            WHERE id = auth.uid() AND tier >= 3
        )
    );

-- AUDIT LOG POLICIES
-- Users can read their own audit entries
CREATE POLICY "Users can view own audit log"
    ON public.audit_log FOR SELECT
    USING (auth.uid() = user_id);

-- Admins can view all audit entries
CREATE POLICY "Admins can view all audit logs"
    ON public.audit_log FOR SELECT
    USING (
        EXISTS (
            SELECT 1 FROM public.profiles
            WHERE id = auth.uid() AND tier >= 3
        )
    );
```

### Database Functions & Triggers

```sql
-- ============================================
-- FUNCTIONS & TRIGGERS
-- ============================================

-- Auto-create profile on user signup
CREATE OR REPLACE FUNCTION public.handle_new_user()
RETURNS TRIGGER AS $$
BEGIN
    INSERT INTO public.profiles (id, email, full_name, avatar_url)
    VALUES (
        NEW.id,
        NEW.email,
        COALESCE(NEW.raw_user_meta_data->>'full_name', NEW.raw_user_meta_data->>'name'),
        NEW.raw_user_meta_data->>'avatar_url'
    );
    RETURN NEW;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

CREATE TRIGGER on_auth_user_created
    AFTER INSERT ON auth.users
    FOR EACH ROW EXECUTE FUNCTION public.handle_new_user();

-- Update timestamp trigger
CREATE OR REPLACE FUNCTION public.update_updated_at()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER update_profiles_updated_at
    BEFORE UPDATE ON public.profiles
    FOR EACH ROW EXECUTE FUNCTION public.update_updated_at();

-- Helper function to check user tier
CREATE OR REPLACE FUNCTION public.get_user_tier(user_id UUID)
RETURNS INTEGER AS $$
    SELECT COALESCE(
        (SELECT tier FROM public.profiles WHERE id = user_id),
        0
    );
$$ LANGUAGE sql SECURITY DEFINER;

-- Helper function to check permission
CREATE OR REPLACE FUNCTION public.user_has_permission(user_id UUID, required_tier INTEGER)
RETURNS BOOLEAN AS $$
    SELECT public.get_user_tier(user_id) >= required_tier;
$$ LANGUAGE sql SECURITY DEFINER;
```

---

## Feature Requirements

### Core Features (Must Have)

#### F1: Authentication Pages
| Feature | Description | Priority |
|---------|-------------|----------|
| F1.1 | Sign up page (email/password) | P0 |
| F1.2 | Login page (email/password) | P0 |
| F1.3 | Password reset flow | P0 |
| F1.4 | Email verification | P0 |
| F1.5 | OAuth integration (Google, GitHub) | P1 |
| F1.6 | Logout functionality | P0 |

#### F2: Protected Routes
| Feature | Description | Priority |
|---------|-------------|----------|
| F2.1 | Middleware-based route protection | P0 |
| F2.2 | Tier-based access control | P0 |
| F2.3 | Redirect to login for unauthenticated | P0 |
| F2.4 | Redirect to upgrade for insufficient tier | P1 |

#### F3: User Profile
| Feature | Description | Priority |
|---------|-------------|----------|
| F3.1 | Profile viewing | P0 |
| F3.2 | Profile editing (name, avatar) | P1 |
| F3.3 | Account settings | P1 |
| F3.4 | Password change | P1 |

#### F4: Admin Features

> **See detailed specifications in [Admin Dashboard](#admin-dashboard) section.**

| Feature | Description | Priority |
|---------|-------------|----------|
| F4.1 | Admin dashboard overview (stats, metrics) | P1 |
| F4.2 | User list with search/filter/pagination | P1 |
| F4.3 | User detail view and tier management | P1 |
| F4.4 | Audit log viewer | P2 |
| F4.5 | Tier configuration management | P2 |

### Utility Features

#### F5: Developer Experience
| Feature | Description | Priority |
|---------|-------------|----------|
| F5.1 | TypeScript strict mode | P0 |
| F5.2 | Environment variable validation | P0 |
| F5.3 | Type-safe database queries | P0 |
| F5.4 | Reusable React hooks | P0 |
| F5.5 | Component library structure | P1 |

---

## Admin Dashboard

### Design Philosophy

The foundation includes a **lightweight custom admin panel** built with the same technology stack as the main application. This approach was chosen over external solutions (like React Admin) for the following reasons:

| Advantage | Description |
|-----------|-------------|
| **Minimal Bundle Size** | No additional framework dependencies (~0 KB added) |
| **Consistent Styling** | Uses same Tailwind CSS + shadcn/ui as the main app |
| **Full Control** | Easy to customize and extend for project-specific needs |
| **Same Patterns** | Developers learn one codebase, not two |
| **Reusable Structure** | Admin patterns work for any entity, not just users |

### Admin Features Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ADMIN DASHBOARD                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  Dashboard  â”‚  â”‚    Users    â”‚  â”‚   Settings  â”‚             â”‚
â”‚  â”‚  (Overview) â”‚  â”‚ (Manage)    â”‚  â”‚  (System)   â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                 â”‚
â”‚  Dashboard:        Users:              Settings:               â”‚
â”‚  - Total users     - List all users    - Tier definitions      â”‚
â”‚  - Users by tier   - Search/filter     - System config         â”‚
â”‚  - Recent signups  - Change tier       - Audit log viewer      â”‚
â”‚  - Active today    - Disable account                           â”‚
â”‚                    - View details                              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Admin Route Structure

```
src/app/(admin)/admin/
â”œâ”€â”€ layout.tsx              # Admin layout with tier 3+ guard
â”œâ”€â”€ page.tsx                # Dashboard overview
â”œâ”€â”€ users/
â”‚   â”œâ”€â”€ page.tsx            # User list with search/filter/pagination
â”‚   â””â”€â”€ [id]/
â”‚       â””â”€â”€ page.tsx        # User detail view & edit
â”œâ”€â”€ tiers/
â”‚   â””â”€â”€ page.tsx            # Tier configuration management
â””â”€â”€ audit/
    â””â”€â”€ page.tsx            # Audit log viewer
```

### Feature Specifications

#### F4.1: Admin Dashboard Overview

**Purpose:** Provide at-a-glance system health and user metrics.

**Components:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin Dashboard                                    [Logout] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Total Usersâ”‚ â”‚ Free Tier  â”‚ â”‚  Premium   â”‚ â”‚   Admins   â”‚â”‚
â”‚  â”‚    1,234   â”‚ â”‚    1,100   â”‚ â”‚    130     â”‚ â”‚      4     â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                              â”‚
â”‚  Recent Signups                    Active Users (24h)        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ user@email.com    2min ago  â”‚  â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘  78%   â”‚â”‚
â”‚  â”‚ another@email.com 15min ago â”‚  â”‚  142 active / 183 total â”‚â”‚
â”‚  â”‚ test@email.com    1hr ago   â”‚  â”‚                         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Data Source:** Server component with direct Supabase queries using service role.

#### F4.2: User List & Management

**Purpose:** View, search, filter, and manage all users in the system.

**Features:**
| Feature | Description |
|---------|-------------|
| User List | Paginated table of all users (25 per page default) |
| Search | Full-text search by email or name |
| Filter by Tier | Dropdown to filter by specific tier |
| Sort | By created date, email, tier, last login |
| Bulk Actions | Select multiple users for tier change |

**User List Table Columns:**
```typescript
interface UserListColumns {
  avatar: string;        // Avatar image or initials
  email: string;         // User email (primary identifier)
  fullName: string;      // Display name
  tier: TierBadge;       // Color-coded tier badge
  createdAt: Date;       // Registration date
  lastLogin: Date;       // Last activity
  status: 'active' | 'disabled';
  actions: ActionMenu;   // Edit, Disable, Delete
}
```

**UI Mockup:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Users                                        [+ Invite User]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ğŸ” Search users...]  [Tier: All â–¼]  [Status: All â–¼]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â˜ â”‚ Avatar â”‚ Email              â”‚ Tier    â”‚ Joined   â”‚ â€¢â€¢â€¢ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â˜ â”‚   JD   â”‚ john@example.com   â”‚ Premium â”‚ Dec 1    â”‚ â€¢â€¢â€¢ â”‚
â”‚  â˜ â”‚   AS   â”‚ alice@example.com  â”‚ Free    â”‚ Nov 28   â”‚ â€¢â€¢â€¢ â”‚
â”‚  â˜ â”‚   BW   â”‚ bob@example.com    â”‚ Admin   â”‚ Nov 15   â”‚ â€¢â€¢â€¢ â”‚
â”‚  â˜ â”‚   CS   â”‚ carol@example.com  â”‚ Free    â”‚ Nov 10   â”‚ â€¢â€¢â€¢ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â—€ Previous â”‚ Page 1 of 50 â”‚ Next â–¶      Showing 1-25 of 1234â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### F4.3: User Detail & Edit

**Purpose:** View full user details and modify user properties.

**Editable Fields (Admin Only):**
| Field | Type | Notes |
|-------|------|-------|
| Tier | Select dropdown | Changes user access level |
| Status | Toggle | Enable/disable account |
| Full Name | Text input | For display purposes |
| Metadata | JSON editor | Custom user data |

**Read-Only Fields:**
- Email (managed by Supabase Auth)
- User ID (UUID)
- Created At
- Last Login
- Email Verified status

**UI Mockup:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† Back to Users                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  john@example.com                                  â”‚
â”‚  â”‚  JD  â”‚  John Doe                                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  Member since December 1, 2024                     â”‚
â”‚                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                              â”‚
â”‚  User Information                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Email         â”‚ john@example.com            (verified) â”‚  â”‚
â”‚  â”‚ User ID       â”‚ 550e8400-e29b-41d4-a716-446655440000   â”‚  â”‚
â”‚  â”‚ Last Login    â”‚ 2 hours ago                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  Account Settings                              [Save Changes]â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Full Name     â”‚ [John Doe                           ]  â”‚  â”‚
â”‚  â”‚ Tier          â”‚ [Premium â–¼]                            â”‚  â”‚
â”‚  â”‚ Status        â”‚ [â—] Active  [ ] Disabled               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  Danger Zone                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [Delete User] - Permanently remove this user           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### F4.4: Audit Log Viewer

**Purpose:** View system activity for security and debugging.

**Captured Events:**
| Event | Data Logged |
|-------|-------------|
| User signup | user_id, email, timestamp |
| User login | user_id, ip_address, timestamp |
| Tier change | user_id, old_tier, new_tier, changed_by |
| Account disabled | user_id, disabled_by, reason |
| Password reset | user_id, timestamp |

### Admin Components

```
src/components/admin/
â”œâ”€â”€ stats-card.tsx          # Metric display card
â”œâ”€â”€ user-table.tsx          # Paginated user table
â”œâ”€â”€ user-table-row.tsx      # Individual user row
â”œâ”€â”€ user-filters.tsx        # Search and filter controls
â”œâ”€â”€ tier-badge.tsx          # Color-coded tier indicator
â”œâ”€â”€ tier-select.tsx         # Tier dropdown selector
â”œâ”€â”€ user-actions-menu.tsx   # Row action dropdown
â”œâ”€â”€ pagination.tsx          # Table pagination controls
â”œâ”€â”€ audit-log-table.tsx     # Audit log display
â””â”€â”€ confirm-dialog.tsx      # Confirmation modal for destructive actions
```

### Admin API Endpoints

```
src/app/api/v1/admin/
â”œâ”€â”€ users/
â”‚   â”œâ”€â”€ route.ts            # GET: list users, POST: create user
â”‚   â””â”€â”€ [id]/
â”‚       â”œâ”€â”€ route.ts        # GET: user detail, PATCH: update, DELETE: remove
â”‚       â””â”€â”€ tier/
â”‚           â””â”€â”€ route.ts    # PATCH: change user tier
â”œâ”€â”€ stats/
â”‚   â””â”€â”€ route.ts            # GET: dashboard statistics
â””â”€â”€ audit/
    â””â”€â”€ route.ts            # GET: audit log entries
```

**API Response Types:**
```typescript
// GET /api/v1/admin/users
interface UsersListResponse {
  users: UserProfile[];
  pagination: {
    page: number;
    perPage: number;
    total: number;
    totalPages: number;
  };
}

// GET /api/v1/admin/stats
interface AdminStatsResponse {
  totalUsers: number;
  usersByTier: Record<string, number>;
  recentSignups: UserProfile[];
  activeToday: number;
}

// PATCH /api/v1/admin/users/[id]/tier
interface ChangeTierRequest {
  tier: number;
  reason?: string;  // Optional audit note
}
```

### Admin Hooks

```typescript
// src/hooks/admin/use-users.ts
export function useUsers(options?: {
  page?: number;
  perPage?: number;
  search?: string;
  tier?: number;
  sortBy?: 'created_at' | 'email' | 'tier';
  sortOrder?: 'asc' | 'desc';
}) {
  // Returns { users, pagination, isLoading, error, refetch }
}

// src/hooks/admin/use-user.ts
export function useUser(userId: string) {
  // Returns { user, isLoading, error, updateUser, deleteUser }
}

// src/hooks/admin/use-admin-stats.ts
export function useAdminStats() {
  // Returns { stats, isLoading, error }
}
```

### Security Considerations for Admin

| Measure | Implementation |
|---------|----------------|
| Route Protection | Middleware checks tier >= 3 before rendering |
| API Protection | All admin API routes verify admin tier server-side |
| Service Role Client | Admin operations use service role (bypasses RLS) |
| Audit Logging | All admin actions are logged with admin user ID |
| Confirmation Dialogs | Destructive actions require explicit confirmation |
| Rate Limiting | Admin APIs have stricter rate limits |

### Upgrade Path

If more sophisticated admin features are needed later, the foundation can be extended with:

1. **React Admin Integration** - Add `ra-supabase` for advanced CRUD
2. **Refine Framework** - Drop-in admin framework with Supabase support
3. **Custom Extensions** - Build on existing patterns for domain-specific admin

---

## Project Structure

```
site-auth-db/
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ PRD.md                    # This document
â”‚   â”œâ”€â”€ SETUP.md                  # Setup instructions
â”‚   â””â”€â”€ ARCHITECTURE.md           # Technical deep-dive
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                      # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ (auth)/               # Auth route group
â”‚   â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ signup/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ forgot-password/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ reset-password/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â””â”€â”€ callback/         # OAuth callback
â”‚   â”‚   â”‚       â””â”€â”€ route.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ (protected)/          # Protected route group
â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ profile/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â””â”€â”€ settings/
â”‚   â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ (admin)/              # Admin route group (tier 3+)
â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx        # Admin layout with tier check
â”‚   â”‚   â”‚   â””â”€â”€ admin/
â”‚   â”‚   â”‚       â”œâ”€â”€ page.tsx      # Dashboard overview
â”‚   â”‚   â”‚       â”œâ”€â”€ users/
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ page.tsx  # User list
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ [id]/
â”‚   â”‚   â”‚       â”‚       â””â”€â”€ page.tsx  # User detail/edit
â”‚   â”‚   â”‚       â”œâ”€â”€ tiers/
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ page.tsx  # Tier management
â”‚   â”‚   â”‚       â””â”€â”€ audit/
â”‚   â”‚   â”‚           â””â”€â”€ page.tsx  # Audit log viewer
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ api/                  # API routes
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ callback/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ route.ts  # OAuth callback handler
â”‚   â”‚   â”‚   â””â”€â”€ v1/
â”‚   â”‚   â”‚       â”œâ”€â”€ users/
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚       â”œâ”€â”€ tiers/
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚       â””â”€â”€ admin/        # Admin API endpoints
â”‚   â”‚   â”‚           â”œâ”€â”€ users/
â”‚   â”‚   â”‚           â”‚   â”œâ”€â”€ route.ts      # List/create users
â”‚   â”‚   â”‚           â”‚   â””â”€â”€ [id]/
â”‚   â”‚   â”‚           â”‚       â”œâ”€â”€ route.ts  # Get/update/delete user
â”‚   â”‚   â”‚           â”‚       â””â”€â”€ tier/
â”‚   â”‚   â”‚           â”‚           â””â”€â”€ route.ts  # Change tier
â”‚   â”‚   â”‚           â”œâ”€â”€ stats/
â”‚   â”‚   â”‚           â”‚   â””â”€â”€ route.ts      # Dashboard stats
â”‚   â”‚   â”‚           â””â”€â”€ audit/
â”‚   â”‚   â”‚               â””â”€â”€ route.ts      # Audit log
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ layout.tsx            # Root layout
â”‚   â”‚   â”œâ”€â”€ page.tsx              # Home page (public)
â”‚   â”‚   â””â”€â”€ globals.css
â”‚   â”‚
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ui/                   # Base UI components
â”‚   â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ input.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ auth/                 # Auth-specific components
â”‚   â”‚   â”‚   â”œâ”€â”€ login-form.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ signup-form.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ oauth-buttons.tsx
â”‚   â”‚   â”‚   â””â”€â”€ auth-provider.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ layout/               # Layout components
â”‚   â”‚   â”‚   â”œâ”€â”€ header.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ footer.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ sidebar.tsx
â”‚   â”‚   â”‚   â””â”€â”€ navigation.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ guards/               # Access control components
â”‚   â”‚   â”‚   â”œâ”€â”€ tier-gate.tsx     # Renders children based on tier
â”‚   â”‚   â”‚   â””â”€â”€ auth-guard.tsx    # Renders children if authenticated
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ admin/                # Admin-specific components
â”‚   â”‚       â”œâ”€â”€ stats-card.tsx    # Metric display card
â”‚   â”‚       â”œâ”€â”€ user-table.tsx    # Paginated user table
â”‚   â”‚       â”œâ”€â”€ user-filters.tsx  # Search and filter controls
â”‚   â”‚       â”œâ”€â”€ tier-badge.tsx    # Color-coded tier indicator
â”‚   â”‚       â”œâ”€â”€ tier-select.tsx   # Tier dropdown selector
â”‚   â”‚       â”œâ”€â”€ pagination.tsx    # Table pagination
â”‚   â”‚       â””â”€â”€ audit-log-table.tsx  # Audit log display
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ supabase/
â”‚   â”‚   â”‚   â”œâ”€â”€ client.ts         # Browser client
â”‚   â”‚   â”‚   â”œâ”€â”€ server.ts         # Server client
â”‚   â”‚   â”‚   â”œâ”€â”€ middleware.ts     # Middleware client
â”‚   â”‚   â”‚   â””â”€â”€ admin.ts          # Service role client (server only)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”œâ”€â”€ actions.ts        # Server actions for auth
â”‚   â”‚   â”‚   â””â”€â”€ utils.ts          # Auth utility functions
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â”‚   â”œâ”€â”€ types.ts          # Generated Supabase types
â”‚   â”‚   â”‚   â””â”€â”€ queries.ts        # Reusable database queries
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚       â”œâ”€â”€ cn.ts             # Tailwind class merging
â”‚   â”‚       â””â”€â”€ validators.ts     # Zod schemas
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ use-user.ts           # Current user hook
â”‚   â”‚   â”œâ”€â”€ use-tier.ts           # User tier hook
â”‚   â”‚   â”œâ”€â”€ use-permission.ts     # Permission check hook
â”‚   â”‚   â””â”€â”€ admin/                # Admin-specific hooks
â”‚   â”‚       â”œâ”€â”€ use-users.ts      # Paginated user list
â”‚   â”‚       â”œâ”€â”€ use-user.ts       # Single user operations
â”‚   â”‚       â””â”€â”€ use-admin-stats.ts  # Dashboard statistics
â”‚   â”‚
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”œâ”€â”€ auth.ts               # Auth-related types
â”‚   â”‚   â”œâ”€â”€ database.ts           # Database types (re-export)
â”‚   â”‚   â””â”€â”€ api.ts                # API response types
â”‚   â”‚
â”‚   â””â”€â”€ middleware.ts             # Next.js middleware (route protection)
â”‚
â”œâ”€â”€ supabase/
â”‚   â”œâ”€â”€ migrations/               # Database migrations
â”‚   â”‚   â”œâ”€â”€ 00001_initial_schema.sql
â”‚   â”‚   â”œâ”€â”€ 00002_rls_policies.sql
â”‚   â”‚   â””â”€â”€ 00003_functions.sql
â”‚   â”‚
â”‚   â”œâ”€â”€ seed.sql                  # Development seed data
â”‚   â””â”€â”€ config.toml               # Supabase local config
â”‚
â”œâ”€â”€ public/
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ .env.example                  # Environment template
â”œâ”€â”€ .env.local                    # Local environment (gitignored)
â”œâ”€â”€ next.config.js
â”œâ”€â”€ tailwind.config.ts
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

---

## VPS Deployment Architecture

### Server Environment Overview

This foundation is designed for deployment on a VPS (Virtual Private Server) with the following directory structure:

```
/usr/home/birdahonk/
â”œâ”€â”€ dev/                          # Development and source code
â”‚   â””â”€â”€ source/
â”‚       â””â”€â”€ site-auth-db/         # This foundation (and cloned projects)
â”‚           â”œâ”€â”€ src/
â”‚           â”œâ”€â”€ package.json
â”‚           â””â”€â”€ ...
â”‚
â””â”€â”€ public_html/                  # Web-accessible directory (Apache/nginx)
    â”œâ”€â”€ myapp.domain.com/         # Subdomain directory (if applicable)
    â””â”€â”€ ...
```

### Deployment Strategy: Reverse Proxy (Recommended)

For Next.js applications with server-side features (SSR, API routes, middleware), **reverse proxy** is the recommended approach. Static file symlinks will NOT work because Next.js requires a Node.js runtime.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     VPS DEPLOYMENT ARCHITECTURE                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   Internet                                                       â”‚
â”‚      â”‚                                                           â”‚
â”‚      â–¼                                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚   â”‚  Apache/nginx (public_html)          â”‚                      â”‚
â”‚   â”‚  Listening on port 80/443            â”‚                      â”‚
â”‚   â”‚  - SSL termination                   â”‚                      â”‚
â”‚   â”‚  - Static file serving (if needed)   â”‚                      â”‚
â”‚   â”‚  - Reverse proxy to Node.js          â”‚                      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                      â”‚                                           â”‚
â”‚                      â”‚ ProxyPass to localhost:3000               â”‚
â”‚                      â–¼                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚   â”‚  Next.js App (Node.js)               â”‚                      â”‚
â”‚   â”‚  Running in ~/dev/source/site-auth-dbâ”‚                      â”‚
â”‚   â”‚  - PM2 or systemd managed            â”‚                      â”‚
â”‚   â”‚  - Port 3000 (internal only)         â”‚                      â”‚
â”‚   â”‚  - Handles SSR, API, middleware      â”‚                      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                      â”‚                                           â”‚
â”‚                      â–¼                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚   â”‚  Supabase (External)                 â”‚                      â”‚
â”‚   â”‚  - PostgreSQL database               â”‚                      â”‚
â”‚   â”‚  - Authentication                    â”‚                      â”‚
â”‚   â”‚  - Storage                           â”‚                      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Why Reverse Proxy (Not Symlinks)?

| Approach | Works for Next.js? | Reason |
|----------|-------------------|--------|
| **Symlink to public_html** | âŒ No | Next.js needs Node.js runtime for SSR, API routes, middleware |
| **Copy build output** | âš ï¸ Partial | Only works for `next export` (static only), loses SSR/API/middleware |
| **Reverse Proxy** | âœ… Yes | Full Next.js features, proper SSR, API routes work |

### Directory Structure Decision

**Source Code Location:** `/usr/home/birdahonk/dev/source/`
- All application source code lives here
- Version controlled with Git
- Not directly web-accessible (secure)

**Web Server Configuration:** `/usr/home/birdahonk/public_html/`
- Contains Apache/nginx configuration files (e.g., `.htaccess`, proxy configs)
- May contain a simple redirect/proxy setup file
- Does NOT contain the actual Next.js application code

### Deployment Options

#### Option A: Subdomain Deployment (Recommended)

Each application gets its own subdomain:
- `myapp.birdahonk.com` â†’ proxies to `localhost:3000`
- `otherapp.birdahonk.com` â†’ proxies to `localhost:3001`

**Apache Virtual Host Configuration:**
```apache
# /usr/home/birdahonk/public_html/myapp.birdahonk.com/.htaccess
# Or in Apache virtual host config

<VirtualHost *:443>
    ServerName myapp.birdahonk.com

    SSLEngine on
    SSLCertificateFile /path/to/cert.pem
    SSLCertificateKeyFile /path/to/key.pem

    ProxyPreserveHost On
    ProxyPass / http://localhost:3000/
    ProxyPassReverse / http://localhost:3000/

    # WebSocket support (for real-time features)
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) ws://localhost:3000/$1 [P,L]
</VirtualHost>
```

#### Option B: Path-Based Deployment

Multiple apps under one domain:
- `birdahonk.com/myapp/` â†’ proxies to `localhost:3000`
- `birdahonk.com/otherapp/` â†’ proxies to `localhost:3001`

**Note:** Requires `basePath` configuration in `next.config.js`:
```javascript
// next.config.js
module.exports = {
  basePath: '/myapp',
  // ... other config
}
```

### Process Management

#### PM2 Setup (Recommended)

PM2 keeps the Node.js application running and restarts on crashes:

```bash
# Install PM2 globally
npm install -g pm2

# Start the application
cd /usr/home/birdahonk/dev/source/site-auth-db
pm2 start npm --name "myapp" -- start

# Configure to start on server reboot
pm2 startup
pm2 save

# Useful commands
pm2 status          # Check running apps
pm2 logs myapp      # View logs
pm2 restart myapp   # Restart after deploy
pm2 stop myapp      # Stop the app
```

#### Ecosystem File for Multiple Apps

```javascript
// /usr/home/birdahonk/dev/ecosystem.config.js
module.exports = {
  apps: [
    {
      name: 'site-auth-db',
      cwd: '/usr/home/birdahonk/dev/source/site-auth-db',
      script: 'npm',
      args: 'start',
      env: {
        NODE_ENV: 'production',
        PORT: 3000
      }
    },
    {
      name: 'another-app',
      cwd: '/usr/home/birdahonk/dev/source/another-app',
      script: 'npm',
      args: 'start',
      env: {
        NODE_ENV: 'production',
        PORT: 3001
      }
    }
  ]
};
```

### Deployment Workflow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     DEPLOYMENT WORKFLOW                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  1. DEVELOP (Local Machine)                                      â”‚
â”‚     â””â”€â”€ Edit code, test locally with `pnpm dev`                 â”‚
â”‚                                                                  â”‚
â”‚  2. PUSH (Git Repository)                                        â”‚
â”‚     â””â”€â”€ git push origin main                                    â”‚
â”‚                                                                  â”‚
â”‚  3. PULL (VPS Server)                                           â”‚
â”‚     â””â”€â”€ ssh into VPS                                            â”‚
â”‚     â””â”€â”€ cd /usr/home/birdahonk/dev/source/site-auth-db          â”‚
â”‚     â””â”€â”€ git pull origin main                                    â”‚
â”‚                                                                  â”‚
â”‚  4. BUILD (VPS Server)                                           â”‚
â”‚     â””â”€â”€ pnpm install (if deps changed)                          â”‚
â”‚     â””â”€â”€ pnpm build                                              â”‚
â”‚                                                                  â”‚
â”‚  5. RESTART (VPS Server)                                         â”‚
â”‚     â””â”€â”€ pm2 restart myapp                                       â”‚
â”‚                                                                  â”‚
â”‚  6. VERIFY                                                       â”‚
â”‚     â””â”€â”€ pm2 logs myapp (check for errors)                       â”‚
â”‚     â””â”€â”€ Visit https://myapp.birdahonk.com                       â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Quick Deploy Script

Create a deploy script at `/usr/home/birdahonk/dev/source/site-auth-db/deploy.sh`:

```bash
#!/bin/bash
# deploy.sh - Run on VPS after git pull

set -e  # Exit on error

echo "ğŸ“¦ Installing dependencies..."
pnpm install --frozen-lockfile

echo "ğŸ”¨ Building application..."
pnpm build

echo "ğŸ”„ Restarting application..."
pm2 restart myapp || pm2 start npm --name "myapp" -- start

echo "âœ… Deployment complete!"
pm2 logs myapp --lines 20
```

### Environment Variables on VPS

Store production environment variables securely:

```bash
# Option 1: PM2 ecosystem file (shown above)
# Option 2: System environment file
# /usr/home/birdahonk/dev/source/site-auth-db/.env.production.local

NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
NEXT_PUBLIC_APP_URL=https://myapp.birdahonk.com
```

**Security Note:** Ensure `.env.production.local` is:
- NOT committed to Git (add to `.gitignore`)
- Has restricted file permissions (`chmod 600`)

### Port Allocation for Multiple Projects

When running multiple cloned projects:

| Project | Port | Subdomain |
|---------|------|-----------|
| site-auth-db (template) | 3000 | template.birdahonk.com |
| project-a | 3001 | project-a.birdahonk.com |
| project-b | 3002 | project-b.birdahonk.com |

Configure each project's port via environment variable or `next.config.js`.

---

## Setup & Configuration Guide

### Prerequisites

- Node.js 18+ (LTS recommended)
- pnpm (recommended) or npm
- Supabase account (free tier works)
- Git

### Step 1: Supabase Project Setup

1. **Create a new Supabase project:**
   - Go to [supabase.com/dashboard](https://supabase.com/dashboard)
   - Click "New Project"
   - Choose organization and region (pick closest to your users)
   - Set a strong database password (save this securely)
   - Wait for project to initialize (~2 minutes)

2. **Configure Authentication:**
   - Navigate to Authentication â†’ Providers
   - **Email:** Enabled by default
     - Configure: Confirm email = ON (recommended for production)
     - Set site URL: `http://localhost:3000` (dev) or your production URL
   - **Google OAuth (optional):**
     - Create OAuth credentials at [Google Cloud Console](https://console.cloud.google.com/apis/credentials)
     - Add client ID and secret to Supabase
     - Add redirect URL: `https://<project-ref>.supabase.co/auth/v1/callback`
   - **GitHub OAuth (optional):**
     - Create OAuth app at GitHub â†’ Settings â†’ Developer settings
     - Add client ID and secret to Supabase

3. **Configure Email Templates (optional):**
   - Navigate to Authentication â†’ Email Templates
   - Customize confirmation, magic link, and password reset emails

4. **Get API Keys:**
   - Navigate to Settings â†’ API
   - Copy:
     - Project URL: `https://<project-ref>.supabase.co`
     - `anon` public key
     - `service_role` key (keep secret!)

### Step 2: Local Development Setup

```bash
# Clone or copy the foundation
git clone <repository-url> my-new-project
cd my-new-project

# Install dependencies
pnpm install

# Copy environment template
cp .env.example .env.local

# Edit .env.local with your Supabase credentials
```

### Step 3: Environment Configuration

Create `.env.local` with these required variables:

```env
# ===========================================
# SUPABASE CONFIGURATION
# ===========================================
NEXT_PUBLIC_SUPABASE_URL=https://<project-ref>.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJ...
SUPABASE_SERVICE_ROLE_KEY=eyJ...  # Server-only, never expose to client

# ===========================================
# APPLICATION CONFIGURATION
# ===========================================
NEXT_PUBLIC_APP_URL=http://localhost:3000
NEXT_PUBLIC_APP_NAME="My App"

# ===========================================
# OPTIONAL: OAUTH PROVIDERS
# ===========================================
# Configured in Supabase Dashboard, not needed here
```

### Step 4: Database Migration

```bash
# Option A: Run migrations via Supabase CLI (recommended)
pnpm supabase db push

# Option B: Manual SQL execution
# Copy contents of supabase/migrations/*.sql
# Paste into Supabase Dashboard â†’ SQL Editor â†’ Run
```

### Step 5: Generate TypeScript Types

```bash
# Generate types from your Supabase schema
pnpm supabase gen types typescript --project-id <project-ref> > src/lib/database/types.ts
```

### Step 6: Run Development Server

```bash
pnpm dev
```

Visit `http://localhost:3000` to see your app.

---

## Security Considerations

### Authentication Security

| Measure | Implementation |
|---------|----------------|
| Password hashing | Bcrypt (handled by Supabase) |
| Session tokens | JWT in HTTP-only cookies |
| CSRF protection | Built into Next.js server actions |
| Rate limiting | Supabase Auth built-in |
| Brute force protection | Account lockout after failed attempts |

### Database Security

| Measure | Implementation |
|---------|----------------|
| Row Level Security | Enabled on all tables |
| SQL injection | Prevented by parameterized queries |
| Data validation | Zod schemas on all inputs |
| Service role isolation | Only used server-side |

### Client Security

| Measure | Implementation |
|---------|----------------|
| XSS prevention | React auto-escaping, CSP headers |
| Sensitive data | Never exposed to client bundle |
| Environment variables | `NEXT_PUBLIC_` prefix only for safe values |

### Security Checklist Before Production

- [ ] Enable email confirmation
- [ ] Configure strong password requirements
- [ ] Set up rate limiting rules
- [ ] Enable HTTPS only (via hosting platform)
- [ ] Review and test all RLS policies
- [ ] Remove seed data
- [ ] Audit all `SECURITY DEFINER` functions
- [ ] Set restrictive CORS policies
- [ ] Configure Content Security Policy headers

---

## Reusability Guidelines

### When Cloning This Foundation

1. **Update Project Identity:**
   - Change `package.json` name and description
   - Update `NEXT_PUBLIC_APP_NAME` in environment
   - Replace favicon and logos

2. **Create New Supabase Project:**
   - Never share databases between projects
   - Run migrations on new project
   - Update environment variables

3. **Customize Tiers:**
   - Modify `supabase/migrations/00001_initial_schema.sql`
   - Add/remove tiers as needed
   - Update RLS policies accordingly

4. **Extend Schema:**
   - Add new migrations (never modify existing ones)
   - Follow naming convention: `00004_add_feature.sql`
   - Always enable RLS on new tables

### What to Keep

- Authentication flow and components
- Tier system architecture
- Supabase client configurations
- Middleware structure
- Project folder organization

### What to Customize

- UI styling and branding
- Tier names and permissions
- Additional database tables
- Business logic and features
- API endpoints

---

## Future Considerations

### Potential Enhancements

| Feature | Complexity | Value |
|---------|------------|-------|
| Multi-factor authentication (TOTP) | Medium | High |
| Social login expansion | Low | Medium |
| Team/organization support | High | High |
| Webhook integrations | Medium | Medium |
| Audit log UI | Medium | Low |
| Rate limiting dashboard | Medium | Low |
| Internationalization (i18n) | Medium | Medium |

### Scalability Path

```
Single Project â†’ Multi-tenant â†’ Enterprise
      â†“               â†“              â†“
  This Foundation   Add org/team   Add SSO/SAML
                    tables +       Compliance
                    RLS            Features
```

---

## Appendix A: Technology Rationale

### Why Next.js 14+ (App Router)?

- Server Components reduce client bundle size
- Built-in API routes colocate with pages
- Middleware for route protection
- Server Actions simplify form handling
- Industry standard, excellent documentation

### Why Tailwind CSS?

- Utility-first reduces custom CSS maintenance
- Easy to override for project-specific branding
- Excellent developer experience
- Tree-shaking removes unused styles

### Why Supabase over raw PostgreSQL?

- Auth system included and integrated
- Real-time subscriptions built-in
- Storage for files included
- Dashboard for data exploration
- Generous free tier

### Why NOT Clerk?

While Clerk is excellent for rapid prototyping, Supabase Auth is preferred here because:

1. **No Vendor Lock-in:** Your auth data lives in your database
2. **Cost Efficiency:** Supabase free tier is more generous for auth
3. **Database Integration:** RLS policies work directly with auth.uid()
4. **Self-Hostable:** Can migrate to self-hosted Supabase if needed
5. **Single Ecosystem:** One vendor for auth + database + storage

---

## Appendix B: Quick Reference

### Environment Variables

| Variable | Required | Description |
|----------|----------|-------------|
| `NEXT_PUBLIC_SUPABASE_URL` | Yes | Supabase project URL |
| `NEXT_PUBLIC_SUPABASE_ANON_KEY` | Yes | Public anon key |
| `SUPABASE_SERVICE_ROLE_KEY` | Yes | Service role key (server only) |
| `NEXT_PUBLIC_APP_URL` | Yes | Your app's URL |
| `NEXT_PUBLIC_APP_NAME` | No | Display name for app |

### Key Files

| File | Purpose |
|------|---------|
| `src/middleware.ts` | Route protection |
| `src/lib/supabase/server.ts` | Server-side Supabase client |
| `src/hooks/use-tier.ts` | Access user tier in components |
| `src/components/guards/tier-gate.tsx` | Conditional rendering by tier |
| `supabase/migrations/*.sql` | Database schema |

### Commands

```bash
pnpm dev              # Start development server
pnpm build            # Production build
pnpm supabase db push # Apply migrations
pnpm supabase gen types typescript  # Generate types
```

---

*End of PRD*
